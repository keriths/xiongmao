<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xm.service.dao.cim.DwsProductOcYieldFidsDAO" >

    <select id="queryProductOcData" resultType="com.xm.service.apiimpl.pc.cim.goodRate.dto.ProductOcDetailData" parameterType="Map">
        select
        sum(POL_OUTPUT) as polOutPut,
        sum(POL_OUTPUT_PA)+
        sum(POL_OUTPUT_JUDGE29)+
        sum(MBI_RJ_OUTPUT_PA)+
        sum(MBI_RJ_OUTPUT_JUDGE29)+
        sum(POL_RW_OUTPUT_PA)+
        sum(POL_RW_OUTPUT_JUDGE29) as polOutPutSum,

        sum(IOB_OUTPUT) as iobOutPut,
        sum(IOB_EI_OUTPUT_A)+
        sum(IOB_EI_OUTPUT_FA)+
        sum(IOB_EI_OUTPUT_S)+
        sum(IOB_EI_OUTPUT_RW_A)+
        sum(IOB_EI_OUTPUT_RW_FA)+
        sum(IOB_EI_OUTPUT_RW_S) as iobOutPutSum,
        <if test="dateType=='month'.toString()">/*按月*/
            TO_CHAR(PERIODDATE,'MM')||'月'
        </if>
        <if test="dateType=='quarter'.toString()">/*按季度*/
            TO_CHAR(PERIODDATE,'yyyy') ||'年' || TO_CHAR(PERIODDATE,'q') ||'季度'
        </if>
        <if test="dateType=='day'.toString()">/*按天*/
            TO_CHAR(PERIODDATE,'mm/dd')
        </if>
        as periodDate
        from DWS_PRODUCT_OC_YIELD_FIDS
        WHERE
        <![CDATA[
            PERIODDATE >= #{beginDate}
            and PERIODDATE <= #{endDate}
        ]]>
        and PRODUCTID in
        <foreach collection="productIdList" item="productId" open="(" separator="," close=")">
            #{productId}
        </foreach>
        and PRODUCTTYPE NOT IN
        <foreach collection="productTypeList" item="productType" open="(" separator="," close=")">
            #{productType}
        </foreach>
        GROUP BY
        <if test="dateType=='month'.toString()">/*按月*/
            TO_CHAR(PERIODDATE,'MM')||'月'
        </if>
        <if test="dateType=='quarter'.toString()">
            TO_CHAR(PERIODDATE,'yyyy') ||'年' || TO_CHAR(PERIODDATE,'q') ||'季度'
        </if>
        <if test="dateType=='day'.toString()">
            TO_CHAR(PERIODDATE,'mm/dd')
        </if>

    </select>



    <select id="queryTotalProductLineOCByDateAndProductList" parameterType="map" resultType="com.xm.service.apiimpl.pc.cim.goodRate.dto.ProductOcDetailData">
        SELECT
        decode(PRODUCTID,'C41A','50', 'D41A','50','A1CC495PU1L01','50','D0NL495PU1L01','50',
        'C51A','58','D51A','58','A1CC575PU1L01','58','A1CC575PU3L01','58',PRODUCTID) as productName,
        sum(POL_OUTPUT) as polOutPut,
        sum(POL_OUTPUT_PA)+
        sum(POL_OUTPUT_JUDGE29)+
        sum(MBI_RJ_OUTPUT_PA)+
        sum(MBI_RJ_OUTPUT_JUDGE29)+
        sum(POL_RW_OUTPUT_PA)+
        sum(POL_RW_OUTPUT_JUDGE29) as polOutPutSum,

        sum(IOB_OUTPUT) as iobOutPut,
        sum(IOB_EI_OUTPUT_A)+
        sum(IOB_EI_OUTPUT_FA)+
        sum(IOB_EI_OUTPUT_S)+
        sum(IOB_EI_OUTPUT_RW_A)+
        sum(IOB_EI_OUTPUT_RW_FA)+
        sum(IOB_EI_OUTPUT_RW_S) as iobOutPutSum
        FROM
        DWS_PRODUCT_OC_YIELD_FIDS
        WHERE
        PRODUCTID IN ('C41A', 'D41A','A1CC495PU1L01','D0NL495PU1L01', 'C51A','D51A','A1CC575PU1L01','A1CC575PU3L01')
        and PRODUCTTYPE NOT IN
        <foreach collection="productTypeList" item="productType" open="(" separator="," close=")">
            #{productType}
        </foreach>
        <![CDATA[
          and PERIODDATE >= #{startDate}
          and PERIODDATE <= #{endDate}
        ]]>
        GROUP BY decode(PRODUCTID,'C41A','50', 'D41A','50','A1CC495PU1L01','50','D0NL495PU1L01','50',
        'C51A','58','D51A','58','A1CC575PU1L01','58','A1CC575PU3L01','58',PRODUCTID)
    </select>



    <select id="loadByPrimaryKey" parameterType="map" resultType="map">
        SELECT * from DWS_PRODUCT_OC_YIELD_FIDS
        where
        FACTORY = #{FACTORY,jdbcType=VARCHAR} and
        PERIODDATE = #{PERIODDATE,jdbcType=DATE} and
        PRODUCTID = #{PRODUCTID,jdbcType=VARCHAR} and
        <if test="PRODUCTTYPE != null">
            PRODUCTTYPE = #{PRODUCTTYPE,jdbcType=VARCHAR}
        </if>
        <if test="PRODUCTTYPE == null">
            PRODUCTTYPE is null
        </if>
    </select>

    <insert id="addData" parameterType="map">
        INSERT INTO  DWS_PRODUCT_OC_YIELD_FIDS
        (
            FACTORY,
            PERIODDATE,
            PRODUCTTYPE,
            PRODUCTID,
            POL_OUTPUT,
            POL_OUTPUT_PA,
            POL_OUTPUT_JUDGE29,
            MBI_RJ_OUTPUT_PA,
            MBI_RJ_OUTPUT_JUDGE29,
            POL_RW_OUTPUT_PA,
            POL_RW_OUTPUT_JUDGE29,
            IOB_OUTPUT,
            IOB_EI_OUTPUT_A,
            IOB_EI_OUTPUT_FA,
            IOB_EI_OUTPUT_S,
            IOB_EI_OUTPUT_RW_A,
            IOB_EI_OUTPUT_RW_FA,
            IOB_EI_OUTPUT_RW_S
        ) VALUES
        (
            #{FACTORY,jdbcType=VARCHAR},
            #{PERIODDATE,jdbcType=DATE},
            #{PRODUCTTYPE,jdbcType=VARCHAR},
            #{PRODUCTID,jdbcType=VARCHAR},
            #{POL_OUTPUT,jdbcType=DOUBLE},
            #{POL_OUTPUT_PA,jdbcType=DOUBLE},
            #{POL_OUTPUT_JUDGE29,jdbcType=DOUBLE},
            #{MBI_RJ_OUTPUT_PA,jdbcType=DOUBLE},
            #{MBI_RJ_OUTPUT_JUDGE29,jdbcType=DOUBLE},
            #{POL_RW_OUTPUT_PA,jdbcType=DOUBLE},
            #{POL_RW_OUTPUT_JUDGE29,jdbcType=DOUBLE},
            #{IOB_OUTPUT,jdbcType=DOUBLE},
            #{IOB_EI_OUTPUT_A,jdbcType=DOUBLE},
            #{IOB_EI_OUTPUT_FA,jdbcType=DOUBLE},
            #{IOB_EI_OUTPUT_S,jdbcType=DOUBLE},
            #{IOB_EI_OUTPUT_RW_A,jdbcType=DOUBLE},
            #{IOB_EI_OUTPUT_RW_FA,jdbcType=DOUBLE},
            #{IOB_EI_OUTPUT_RW_S,jdbcType=DOUBLE}
        )
    </insert>

    <update id="updateData" parameterType="map">
        UPDATE DWS_PRODUCT_OC_YIELD_FIDS set
            POL_OUTPUT = #{POL_OUTPUT,jdbcType=DOUBLE},
            POL_OUTPUT_PA = #{POL_OUTPUT_PA,jdbcType=DOUBLE},
            POL_OUTPUT_JUDGE29 = #{POL_OUTPUT_JUDGE29,jdbcType=DOUBLE},
            MBI_RJ_OUTPUT_PA = #{MBI_RJ_OUTPUT_PA,jdbcType=DOUBLE},
            MBI_RJ_OUTPUT_JUDGE29 = #{MBI_RJ_OUTPUT_JUDGE29,jdbcType=DOUBLE},
            POL_RW_OUTPUT_PA = #{POL_RW_OUTPUT_PA,jdbcType=DOUBLE},
            POL_RW_OUTPUT_JUDGE29 = #{POL_RW_OUTPUT_JUDGE29,jdbcType=DOUBLE},
            IOB_OUTPUT = #{IOB_OUTPUT,jdbcType=DOUBLE},
            IOB_EI_OUTPUT_A = #{IOB_EI_OUTPUT_A,jdbcType=DOUBLE},
            IOB_EI_OUTPUT_FA = #{IOB_EI_OUTPUT_FA,jdbcType=DOUBLE},
            IOB_EI_OUTPUT_S = #{IOB_EI_OUTPUT_S,jdbcType=DOUBLE},
            IOB_EI_OUTPUT_RW_A = #{IOB_EI_OUTPUT_RW_A,jdbcType=DOUBLE},
            IOB_EI_OUTPUT_RW_FA = #{IOB_EI_OUTPUT_RW_FA,jdbcType=DOUBLE},
            IOB_EI_OUTPUT_RW_S = #{IOB_EI_OUTPUT_RW_S,jdbcType=DOUBLE}
        WHERE
            FACTORY = #{FACTORY,jdbcType=VARCHAR} and
            PERIODDATE = #{PERIODDATE,jdbcType=DATE} and
            PRODUCTID = #{PRODUCTID,jdbcType=VARCHAR} and
            <if test="PRODUCTTYPE != null">
                PRODUCTTYPE = #{PRODUCTTYPE,jdbcType=VARCHAR}
            </if>
            <if test="PRODUCTTYPE == null">
                PRODUCTTYPE is null
            </if>
    </update>
</mapper>