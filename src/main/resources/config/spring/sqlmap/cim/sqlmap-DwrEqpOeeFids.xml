<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xm.service.dao.cim.DwrEqpOeeFidsDAO" >

    <select id="queryActivationEQPId" parameterType="map" resultType="com.xm.service.apiimpl.pc.cim.oee.dto.ActivationDate$StatusDateList">
        SELECT
        EQP_STATUS as status,
        sum(STATUS_DURATION) as statusNum
        FROM
        DWR_EQP_OEE_FIDS
        WHERE
        FACTORY IN
        <foreach collection="factoryList" item="factory" open="(" separator="," close=")">
            #{factory}
        </foreach>
        AND EQP_ID IN
        <foreach collection="eqpIdList" item="eqpId" open="(" separator="," close=")" >
            #{eqpId}
        </foreach>
        <![CDATA[
          and PERIODDATE >= #{beginDate}
          and PERIODDATE <= #{endDate}
          ]]>
        GROUP BY EQP_STATUS
    </select>

    <select id="queryActivationStatusNum" parameterType="map" resultType="com.xm.service.apiimpl.pc.cim.oee.dto.ActivationStatusDate$StatusNumberList">
        SELECT
        decode(FACTORY,'SL','SL-OC','OC','SL-OC',FACTORY) as factory,
        to_char(PERIODDATE,'HH24')||':00' as periodDate,
        EQP_STATUS as status,
        sum(STATUS_DURATION) as statusNum
        FROM
        DWR_EQP_OEE_FIDS
        WHERE
        FACTORY IN
        <foreach collection="factoryList" item="factory" open="(" separator="," close=")">
            #{factory}
        </foreach>
        and EQP_ID IN
        <foreach collection="eqpIdList" item="eqpId" open="(" separator="," close=")" >
            #{eqpId}
        </foreach>
        <![CDATA[
          and PERIODDATE >= #{beginDate}
          and PERIODDATE <= #{endDate}
          ]]>
        GROUP BY decode(FACTORY,'SL','SL-OC','OC','SL-OC',FACTORY) ,
        to_char(PERIODDATE,'HH24')||':00' ,
        EQP_STATUS
    </select>

    <select id="loadByPrimaryKey" parameterType="map" resultType="map">
        SELECT * from DWR_EQP_OEE_FIDS
        where FACTORY = #{FACTORY} and
        PERIODDATE = #{PERIODDATE} and
        <if test="EQP_TYPE == null">
            EQP_TYPE is null and
        </if>
        <if test="EQP_TYPE != null">
            EQP_TYPE = #{EQP_TYPE} and
        </if>
        EQP_ID = #{EQP_ID} and
        EQP_STATUS = #{EQP_STATUS}
    </select>
    <insert id="addData" parameterType="map">
        INSERT INTO  DWR_EQP_OEE_FIDS
        (FACTORY,   PERIODDATE,   EQP_TYPE,   EQP_ID,   EQP_STATUS,   STATUS_DURATION,   INTERFACE_TIME) VALUES
        (#{FACTORY},#{PERIODDATE},
        <if test="EQP_TYPE == null">
            null
        </if>
        <if test="EQP_TYPE != null">
            #{EQP_TYPE}
        </if>
        ,#{EQP_ID},#{EQP_STATUS},#{STATUS_DURATION},sysdate)
    </insert>
    <update id="updateData" parameterType="map">
        UPDATE DWR_EQP_OEE_FIDS SET
        STATUS_DURATION = #{STATUS_DURATION} ,
        INTERFACE_TIME = sysdate
        WHERE
        FACTORY = #{FACTORY} and
        PERIODDATE = #{PERIODDATE} and
        <if test="EQP_TYPE == null">
            EQP_TYPE is null and
        </if>
        <if test="EQP_TYPE != null">
            EQP_TYPE = #{EQP_TYPE} and
        </if>
        EQP_ID = #{EQP_ID} and
        EQP_STATUS = #{EQP_STATUS}
    </update>

</mapper>