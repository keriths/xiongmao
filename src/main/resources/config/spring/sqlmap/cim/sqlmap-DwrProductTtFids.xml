<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xm.service.dao.cim.DwrProductTtFidsDAO" >
    <select id="queryMonthAvg" resultType="com.xm.service.apiimpl.pc.cim.tactTime.dto.TactTimeMonthAvgDataDTO" parameterType="map">
        select
            avg(TT_TARGET) as target,
            avg(TOTAL_GLS_QTY) as actual,
            PRODUCTID as productId
        from DWR_PRODUCT_TT_FIDS
        WHERE
          FACTORY=#{factory}
          AND PRODUCTID IN
          <foreach collection="productIdList" item="productId" open="(" separator="," close=")" >
              #{productId}
          </foreach>
        <![CDATA[
          and PERIODDATE >= #{beginDate}
          and PERIODDATE <= #{endDate}
          ]]>
        group by PRODUCTID
    </select>

    <select id="queryTactTimeListByProductIdAndTime" parameterType="map" resultType="com.xm.service.apiimpl.pc.cim.tactTime.dto.TactTimeProductTimeListRetDTO$TactTimeProductDetail">
        SELECT
          TT_TARGET as target,
          TOTAL_GLS_QTY as total,
          to_char(PERIODDATE,'HH24')||':00' as periodDate,
          PRODUCTID
        FROM
          DWR_PRODUCT_TT_FIDS
        WHERE
          FACTORY=#{factory}
          and PRODUCTID=#{productId}
          <![CDATA[
          and PERIODDATE >= #{beginDate}
          and PERIODDATE <= #{endDate}
          ]]>
    </select>

    <select id="loadByPrimaryKey" parameterType="map" resultType="map">
        SELECT * from DWR_PRODUCT_TT_FIDS
        where FACTORY = #{FACTORY} and
        PERIODDATE = #{PERIODDATE} and
        PRODUCTTYPE = #{PRODUCTTYPE} and
        PRODUCTID = #{PRODUCTID}
    </select>
    <insert id="addData" parameterType="map">
        INSERT INTO  DWR_PRODUCT_TT_FIDS
        (FACTORY,   PERIODDATE,   PRODUCTTYPE,   PRODUCTID,   TT_TARGET,   TOTAL_TT,   TOTAL_GLS_QTY,   INTERFACE_TIME) VALUES
        (#{FACTORY},#{PERIODDATE},#{PRODUCTTYPE},#{PRODUCTID},#{TT_TARGET},#{TOTAL_TT},#{TOTAL_GLS_QTY},sysdate)
    </insert>
    <update id="updateData" parameterType="map">
        UPDATE DWR_PRODUCT_TT_FIDS SET
        TT_TARGET = #{TT_TARGET} ,
        TOTAL_TT = #{TOTAL_TT} ,
        TOTAL_GLS_QTY = #{TOTAL_GLS_QTY},
        INTERFACE_TIME = sysdate
        WHERE
        FACTORY = #{FACTORY} and
        PERIODDATE = #{PERIODDATE} and
        PRODUCTTYPE = #{PRODUCTTYPE} and
        PRODUCTID = #{PRODUCTID}
    </update>
</mapper>