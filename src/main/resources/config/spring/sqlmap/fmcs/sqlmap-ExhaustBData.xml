<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xm.service.dao.fmcs.ExhaustBDataDAO" >

    <select id="queryExhaustBData" resultType="com.xm.service.apiimpl.pc.fmcs.exhaust.dto.ExhaustBData" parameterType="Map">
        select
            KEY as key,
            VAL as val,
            KEYDESC as keyDesc,
            DATADATE as dataDate,
            DATATYPE as dataType,
            DEMODATA as demoData,
            UNIT as unit
        from EXHAUSTBDATA  a
        join (
        select key as keyb,max(DATADATE) as DATADATEb from EXHAUSTBDATA
         WHERE VAL is not null and VAL != -2147483648
         group by key )
        b on  a.key = b.keyb and a.DATADATE = b.DATADATEb
         WHERE VAL is not null and VAL != -2147483648
    </select>

    <select id="queryKeyStatusNum" resultType="int" parameterType="Map">
        select
            count(*)
        from EXHAUSTBDATA  a
        join (
            select key as keyb,max(DATADATE) as DATADATEb from EXHAUSTBDATA
             WHERE VAL is not null and VAL != -2147483648
             group by key
        ) b on  a.key = b.keyb and a.DATADATE = b.DATADATEb
         WHERE KEY like '%-${key}-%' and val = '${status}' and VAL is not null and VAL != -2147483648
    </select>


    <!--&lt;!&ndash;根据key查询&ndash;&gt;-->
    <!--<select id="queryStatusByKey" parameterType="map" resultType="com.xm.service.apiimpl.pc.fmcs.exhaust.dto.SyncExhaustBData">-->
        <!--select-->
        <!--KEY as key,-->
        <!--VAL as val,-->
        <!--KEYDESC as keyDesc,-->
        <!--DATATYPE as dataType,-->
        <!--DEMODATA as demoData,-->
        <!--DATADATE as dataDate-->
        <!--from EXHAUSTBDATA-->
        <!--WHERE-->
        <!--KEY=#{key}-->
    <!--</select>-->


</mapper>